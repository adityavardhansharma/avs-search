// Get DOM elements
const searchInput = document.getElementById("search-input");
const suggestionsContainer = document.getElementById("suggestions");
const searchBtn = document.getElementById("search-btn");

const engineSelectorContainer = document.getElementById("engine-selector-container");
const engineSelectorMain = document.getElementById("engine-selector-main");
const currentEngineIcon = document.getElementById("current-engine-icon");
const engineOptions = document.getElementById("engine-options");
const engineOptionButtons = document.querySelectorAll(".engine-option");

let suggestionsData = [];
let activeIndex = -1;
let controller = null;
let clientCache = {};
let currentEngine = "web";

const engines = {
    web: {
        icon: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.83824 18.4467C10.0103 18.7692 10.1826 19.0598 10.3473 19.3173C8.59745 18.9238 7.07906 17.9187 6.02838 16.5383C6.72181 16.1478 7.60995 15.743 8.67766 15.4468C8.98112 16.637 9.40924 17.6423 9.83824 18.4467ZM11.1618 17.7408C10.7891 17.0421 10.4156 16.1695 10.1465 15.1356C10.7258 15.0496 11.3442 15 12.0001 15C12.6559 15 13.2743 15.0496 13.8535 15.1355C13.5844 16.1695 13.2109 17.0421 12.8382 17.7408C12.5394 18.3011 12.2417 18.7484 12 19.0757C11.7583 18.7484 11.4606 18.3011 11.1618 17.7408ZM9.75 12C9.75 12.5841 9.7893 13.1385 9.8586 13.6619C10.5269 13.5594 11.2414 13.5 12.0001 13.5C12.7587 13.5 13.4732 13.5593 14.1414 13.6619C14.2107 13.1384 14.25 12.5841 14.25 12C14.25 11.4159 14.2107 10.8616 14.1414 10.3381C13.4732 10.4406 12.7587 10.5 12.0001 10.5C11.2414 10.5 10.5269 10.4406 9.8586 10.3381C9.7893 10.8615 9.75 11.4159 9.75 12ZM8.38688 10.0288C8.29977 10.6478 8.25 11.3054 8.25 12C8.25 12.6946 8.29977 13.3522 8.38688 13.9712C7.11338 14.3131 6.05882 14.7952 5.24324 15.2591C4.76698 14.2736 4.5 13.168 4.5 12C4.5 10.832 4.76698 9.72644 5.24323 8.74088C6.05872 9.20472 7.1133 9.68686 8.38688 10.0288ZM10.1465 8.86445C10.7258 8.95042 11.3442 9 12.0001 9C12.6559 9 13.2743 8.95043 13.8535 8.86447C13.5844 7.83055 13.2109 6.95793 12.8382 6.2592C12.5394 5.69894 12.2417 5.25156 12 4.92432C11.7583 5.25156 11.4606 5.69894 11.1618 6.25918C10.7891 6.95791 10.4156 7.83053 10.1465 8.86445ZM15.6131 10.0289C15.7002 10.6479 15.75 11.3055 15.75 12C15.75 12.6946 15.7002 13.3521 15.6131 13.9711C16.8866 14.3131 17.9412 14.7952 18.7568 15.2591C19.233 14.2735 19.5 13.1679 19.5 12C19.5 10.8321 19.233 9.72647 18.7568 8.74093C17.9413 9.20477 16.8867 9.6869 15.6131 10.0289ZM17.9716 7.46178C17.2781 7.85231 16.39 8.25705 15.3224 8.55328C15.0189 7.36304 14.5908 6.35769 14.1618 5.55332C13.9897 5.23077 13.8174 4.94025 13.6527 4.6827C15.4026 5.07623 16.921 6.08136 17.9716 7.46178ZM8.67765 8.55325C7.61001 8.25701 6.7219 7.85227 6.02839 7.46173C7.07906 6.08134 8.59745 5.07623 10.3472 4.6827C10.1826 4.94025 10.0103 5.23076 9.83823 5.5533C9.40924 6.35767 8.98112 7.36301 8.67765 8.55325ZM15.3224 15.4467C15.0189 16.637 14.5908 17.6423 14.1618 18.4467C13.9897 18.7692 13.8174 19.0598 13.6527 19.3173C15.4026 18.9238 16.921 17.9186 17.9717 16.5382C17.2782 16.1477 16.3901 15.743 15.3224 15.4467ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" fill="#60a5fa"/>
            </svg>`,
        bang: ""
    },
    reddit: {
        icon: `<svg fill="#60a5fa" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
              <path d="M12.606 20.986c-0.225 0.001-0.407 0.183-0.407 0.408 0 0.112 0.045 0.214 0.118 0.288l-0-0c0.952 0.716 2.155 1.146 3.457 1.146 0.085 0 0.17-0.002 0.255-0.006l-0.012 0c0.081 0.004 0.175 0.006 0.27 0.006 1.294 0 2.488-0.431 3.445-1.158l-0.014 0.010c0.077-0.081 0.124-0.19 0.124-0.311 0-0.101-0.033-0.194-0.089-0.269l0.001 0.001c-0.074-0.074-0.177-0.119-0.29-0.119s-0.215 0.045-0.29 0.119l0-0c-0.799 0.575-1.798 0.919-2.877 0.919-0.092 0-0.184-0.003-0.275-0.007l0.013 0.001c-0.082 0.005-0.178 0.008-0.274 0.008-1.075 0-2.070-0.345-2.88-0.93l0.014 0.010c-0.074-0.073-0.175-0.119-0.287-0.119-0.001 0-0.002 0-0.003 0h0zM19.436 16c-0.861 0.001-1.56 0.699-1.56 1.561s0.699 1.561 1.561 1.561 1.561-0.699 1.561-1.561v0c-0.002-0.862-0.7-1.56-1.562-1.561h-0zM12.563 16c0.861 0 1.56 0.699 1.56 1.56s-0.699 1.56-1.56 1.56-1.56-0.699-1.56-1.56c0-0.861 0.698-1.56 1.56-1.56h0zM22.261 6.933c0.852 0.006 1.54 0.698 1.54 1.551 0 0.857-0.694 1.551-1.551 1.551-0.828 0-1.505-0.65-1.549-1.467l-0-0.004-3.245-0.684-1 4.682c2.185 0.049 4.201 0.737 5.878 1.884l-0.037-0.024c0.38-0.379 0.905-0.614 1.485-0.614 0.008 0 0.017 0 0.025 0h-0.001c1.21 0.001 2.191 0.982 2.192 2.192v0c-0.007 0.88-0.513 1.64-1.249 2.011l-0.013 0.006c0.033 0.191 0.052 0.412 0.052 0.637 0 0.005 0 0.009-0 0.014v-0.001c0 3.367-3.911 6.086-8.752 6.086s-8.752-2.719-8.752-6.086c0-0.001 0-0.003 0-0.005 0-0.234 0.020-0.463 0.057-0.687l-0.003 0.024c-0.771-0.35-1.298-1.114-1.298-2.001 0-1.21 0.981-2.191 2.191-2.191 0 0 0.001 0 0.001 0h-0c0.586 0.006 1.116 0.238 1.509 0.613l-0.001-0.001c1.66-1.148 3.711-1.841 5.924-1.858l0.004-0 1.106-5.226c0.028-0.103 0.090-0.189 0.173-0.245l0.002-0.001c0.063-0.037 0.139-0.059 0.22-0.059 0.027 0 0.054 0.003 0.080 0.007l-0.003-0 3.631 0.771c0.247-0.522 0.77-0.876 1.375-0.876 0.003 0 0.007 0 0.010 0h-0.001zM16 1.004c0 0 0 0-0 0-8.282 0-14.996 6.714-14.996 14.996s6.714 14.996 14.996 14.996c8.282 0 14.996-6.714 14.996-14.996 0-4.141-1.678-7.89-4.392-10.604v0c-2.714-2.714-6.463-4.392-10.604-4.392v0z"></path>
            </svg>`,
        bang: "!r "
    },
    imdb: {
        icon: `<svg fill="#60a5fa" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
              <path d="m18.8 13.768v-1.875c0-.013.001-.028.001-.044 0-.137-.02-.27-.057-.395l.002.01q-.054-.16-.32-.16t-.268.59v.16c-.026.245-.042.529-.042.817 0 .545.054 1.077.157 1.592l-.009-.051q.054.107.24.107c.007.001.015.001.023.001.102 0 .188-.067.217-.16v-.002c.035-.125.055-.27.055-.418 0-.022 0-.043-.001-.065v.003zm-4.607-3.322c.002-.025.003-.053.003-.082 0-.163-.03-.319-.086-.463l.003.009q-.08-.16-.455-.16v4.5q.375 0 .455-.187c.052-.156.083-.336.083-.523 0-.033-.001-.065-.003-.098v.004zm9.807-7.874c0-.013 0-.029 0-.045 0-.696-.287-1.326-.749-1.776l-.001-.001c-.451-.463-1.08-.75-1.777-.75-.016 0-.031 0-.047 0h.002-18.858c-.013 0-.028 0-.044 0-.697 0-1.327.287-1.777.75l-.001.001c-.463.451-.75 1.08-.75 1.777v.046-.002 18.858.043c0 .696.287 1.326.749 1.776l.001.001c.451.463 1.08.75 1.777.75h.047-.002 18.858.045c.696 0 1.326-.287 1.776-.749l.001-.001c.463-.451.75-1.08.75-1.777 0-.015 0-.03 0-.045v.002zm-18.8 6v6.858h-1.771v-6.857zm6.054 0v6.858h-1.503v-4.661l-.64 4.661h-1.128l-.64-4.554v4.554h-1.557v-6.857h2.303q.16 1.018.429 3.161l.054.054.375-3.214zm4.66 2.41v1.446c.005.129.007.279.007.431 0 .604-.042 1.198-.122 1.779l.008-.067c-.1.383-.408.675-.794.749l-.006.001c-.548.074-1.182.116-1.825.116-.168 0-.336-.003-.502-.009l.024.001h-.8v-6.857h1.5c.068-.002.148-.004.228-.004.431 0 .852.04 1.26.118l-.042-.007c.499.108.881.509.959 1.011l.001.007c.071.296.112.636.112.985 0 .049-.001.098-.002.146v-.007zm4.608.96h-.058v1.929c.002.044.004.096.004.148 0 .35-.06.686-.17.998l.006-.021c-.179.293-.498.485-.861.485-.036 0-.072-.002-.107-.006h.004c-.011 0-.023 0-.035 0-.448 0-.852-.184-1.143-.48l-.054.429h-1.608v-6.857h1.66v2.25c.272-.314.671-.511 1.117-.511.031 0 .062.001.093.003h-.004c.031-.003.066-.005.102-.005.35 0 .658.182.833.456l.002.004c.141.288.223.626.223.984 0 .069-.003.137-.009.204l.001-.009z"></path>
            </svg>`,
        bang: "!imdb "
    },
    amazon: {
        icon: `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" 
                xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" 
                xml:space="preserve" fill="#60a5fa" class="h-6 w-6">
              <path style="fill-rule: evenodd; clip-rule: evenodd;" d="M293.596,233.97 c0,26.322,0.627,48.264-12.651,71.65c-10.724,19.022-27.791,30.698-46.749,30.698c-25.905,0-41.069-19.73-41.069-48.979 c0-57.525,51.607-67.983,100.469-67.983V233.97z M361.701,398.655c-4.48,4.005-10.934,4.283-15.971,1.567 c-22.446-18.64-26.462-27.263-38.718-45.009c-37.07,37.767-63.335,49.094-111.356,49.094c-56.871,0-101.09-35.085-101.09-105.269 c0-54.833,29.688-92.112,72.023-110.394c36.647-16.086,87.836-19.004,127.006-23.397v-8.774c0-16.074,1.253-35.091-8.218-48.979 c-8.217-12.43-24.013-17.542-37.905-17.542c-25.76,0-48.67,13.196-54.288,40.552c-1.178,6.094-5.612,12.11-11.745,12.425 l-65.459-7.092c-5.524-1.241-11.676-5.682-10.074-14.119c15.036-79.421,86.762-103.418,151.037-103.418 c32.857,0,75.823,8.774,101.729,33.63c32.857,30.71,29.7,71.65,29.7,116.248v105.223c0,31.65,13.138,45.543,25.487,62.615 c4.317,6.128,5.292,13.44-0.209,17.92c-13.8,11.571-38.324,32.869-51.811,44.87L361.701,398.655z M454.261,417.377 c-62.721,26.602-130.884,39.461-192.884,39.461c-91.933,0-180.924-25.209-252.882-67.096c-6.302-3.668-10.968,2.797-5.733,7.532 c66.702,60.236,154.845,96.425,252.732,96.425c69.846,0,150.949-21.971,206.903-63.254 C471.646,423.598,463.72,413.361,454.261,417.377z M470.962,467.655c-2.043,5.106,2.345,7.172,6.964,3.296 c30.014-25.116,37.767-77.716,31.615-85.317c-6.093-7.532-58.565-14.021-90.599,8.461c-4.921,3.481-4.062,8.24,1.394,7.59 c18.036-2.17,58.182-6.986,65.343,2.183C492.828,413.036,477.717,450.779,470.962,467.655z"></path>
            </svg>`,
        bang: "!ain "
    },
    youtube: {
        icon: `<svg fill="#60a5fa" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
              <path d="M24.325 8.309s-2.655-.334-8.357-.334c-5.517 0-8.294.334-8.294.334A2.675 2.675 0 0 0 5 10.984v10.034a2.675 2.675 0 0 0 2.674 2.676s2.582.332 8.294.332c5.709 0 8.357-.332 8.357-.332A2.673 2.673 0 0 0 27 21.018V10.982a2.673 2.673 0 0 0-2.675-2.673zM13.061 19.975V12.03L20.195 16l-7.134 3.975z"></path>
            </svg>`,
        bang: "!yt "
    },
    ai: {
        icon: `<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" fill="#60a5fa" class="h-6 w-6">
              <g id="Layer_2" data-name="Layer 2">
                <g id="invisible_box" data-name="invisible box">
                  <rect width="48" height="48" fill="none"></rect>
                </g>
                <g id="Q3_icons" data-name="Q3 icons">
                  <g>
                    <path d="M17.9,2h-.4L7.6,6.6a1,1,0,0,0-.6.9v7.4l-.6.5-4,3.3a.8.8,0,0,0-.4.8v9a.9.9,0,0,0,.4.8l4,3.3.6.5v7.4a1,1,0,0,0,.6.9l9.9,4.5h.4l.6-.2,4-2.7V25.5H21a1.5,1.5,0,0,1,0-3h1.5V4.9l-4-2.7ZM9,13.5l2.8,1.9a1.5,1.5,0,0,1,.4,2.1,1.4,1.4,0,0,1-1.2.7,1.1,1.1,0,0,1-.8-.3L9,17.1Zm-5,9H7.5a1.5,1.5,0,0,1,0,3H4Zm5,8.4,1.2-.8a1.4,1.4,0,0,1,2,.4,1.5,1.5,0,0,1-.4,2.1L9,34.5ZM19.5,18.6l-4,4v2.8l4,4v5.2l-3.4,3.5a2.1,2.1,0,0,1-1.1.4,2.1,2.1,0,0,1-1.1-.4,1.6,1.6,0,0,1,0-2.2l2.6-2.5V30.6l-4-4V21.4l4-4V14.6l-2.6-2.5a1.6,1.6,0,1,1,2.2-2.2l3.4,3.5Z"></path>
                    <path d="M45.6,18.7l-4-3.3-.6-.5V7.5a1,1,0,0,0-.6-.9L30.5,2.1h-.4l-.6.2-4,2.7V22.5H27a1.5,1.5,0,0,1,0,3H25.5V43.1l4,2.7.6.2h.4l9.9-4.5a1,1,0,0,0,.6-.9V33.1l.6-.5,4-3.3a.9.9,0,0,0,.4-.8v-9A.8.8,0,0,0,45.6,18.7ZM39,17.1l-1.2.8a1.1,1.1,0,0,1-.8.3,1.4,1.4,0,0,1-1.2-.7,1.5,1.5,0,0,1,.4-2.1L39,13.5ZM28.5,29.4l4-4V22.6l-4-4V13.4l3.4-3.5a1.6,1.6,0,0,1,2.2,2.2l-2.6,2.5v2.8l4,4v5.2l-4,4v2.8l2.6,2.5a1.6,1.6,0,0,1,0,2.2,1.7,1.7,0,0,1-2.2,0l-3.4-3.5ZM39,34.5l-2.8-1.9a1.5,1.5,0,0,1-.4-2.1,1.4,1.4,0,0,1,2-.4l1.2.8Zm5-9H40.5a1.5,1.5,0,0,1,0-3H44Z"></path>
                  </g>
                </g>
              </g>
            </svg>`,
        bang: "!t3 "
    },
    "ai-with-search": {
        icon: `<svg fill="#60a5fa" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 256 241" class="h-6 w-6">
            <path d="M254,188V2H2v186h111v29H75v22h106v-22h-38v-29H254z M19,19h217v151H19L19,19z M179.966,61.995 c-1.298-2.503-2.874-4.264-4.728-5.284c-0.093-2.688-1.298-4.913-3.245-6.86c-2.318-2.318-5.377-3.523-8.714-3.523 c-3.801-4.45-13.071-7.138-20.766-5.933c-3.801-1.854-8.714-1.761-12.051-1.761c-0.464,0-0.834,0-1.298,0h-0.464 c-3.986,0-10.939-0.093-14.74,3.245c-3.708-1.483-9.548-0.834-14.276,0.556c-5.84,1.854-9.919,4.728-11.402,8.158 c-3.801,0.927-8.621,4.357-11.495,8.529c-2.225,3.245-4.357,8.158-2.41,14.276c-2.225,5.748-1.02,11.959,3.245,16.872 c4.357,5.099,10.939,7.324,16.779,5.748c3.245,0.371,5.655,0.185,7.324-0.185c0.371,2.874,1.483,6.582,4.728,9.178 c1.298,2.966,3.801,5.191,7.045,6.118c3.708,1.02,7.787,0.371,10.846-1.761c1.112-0.093,2.41-0.185,3.801-0.464 c-0.185,2.318,0,4.45,0.556,6.304c0.185,1.947,1.947,12.422,12.33,17.428c10.568,5.099,10.105,8.158,10.105,9.085 c0,3.059,3.523,4.821,7.045,4.913c0.093,0,0.185,0,0.464,0c3.523,0,6.118-1.947,6.304-4.821c0.464-6.118-0.556-7.231-5.006-12.422 c-1.483-1.761-2.41-4.821-2.967-6.86c2.039-0.464,3.894-1.112,5.655-2.039c2.688,0,5.284-1.02,7.231-2.967 c1.947-1.947,3.059-4.357,3.245-7.138c6.304-4.357,9.456-14.091,7.602-23.917C183.674,79.608,183.303,68.762,179.966,61.995z M169.861,106.956c-0.834,0.464-1.298,1.298-1.112,2.039c0.093,1.947-0.556,3.801-1.854,5.099c-1.112,1.112-2.688,1.761-4.172,1.761 c-6.118-2.318-5.84-7.231-5.748-7.787c0.093-1.298-0.834-2.41-2.039-2.503s-2.41,0.834-2.503,2.039 c-0.371,2.41,0.464,7.045,4.635,10.383c-2.874,0.834-6.582,1.112-11.495,1.112c-5.562,0-9.27-1.112-11.124-3.523 c-1.391-1.761-1.761-4.264-1.112-7.324c6.767-1.298,8.992,1.854,9.085,2.039c0.464,0.649,1.112,1.112,1.947,1.112 c0.371,0,0.834-0.093,1.112-0.371c1.112-0.556,1.483-2.039,0.927-3.059c-0.093-0.185-3.986-6.675-15.389-3.986l0,0 c-2.318,0.464-4.357,0.649-6.118,0.834c-4.913-5.84-1.391-10.012-0.927-10.475c0.927-0.927,0.834-2.41-0.093-3.245 c-0.927-0.927-2.41-0.834-3.245,0c-2.41,2.41-5.099,8.621-0.185,15.389c-1.576,0.556-3.523,0.649-5.191,0.185 c-1.483-0.464-3.337-1.391-4.264-3.894c-0.093-0.464-0.464-0.834-0.834-1.02c-4.172-3.059-3.523-8.714-3.43-9.641 c0.834-2.318,3.337-7.509,10.475-9.548c3.245-0.927,5.84-0.371,9.085,0.185c0.927,0.185,1.947,0.371,2.966,0.556 c1.112,8.251,9.919,11.402,10.197,11.588c0.185,0.093,0.464,0.093,0.834,0.093c0.927,0,1.854-0.556,2.225-1.483 c0.464-1.112-0.185-2.503-1.391-2.874c-0.093,0-5.655-2.039-7.045-6.86c7.602-0.185,10.383-5.933,10.661-9.085 c0.093-1.298-0.649-2.41-1.947-2.503c-1.298-0.093-2.41,0.649-2.503,1.947c-0.093,0.464-0.927,5.099-6.675,5.099 c-2.318,0-4.357-0.464-6.304-0.834c-3.43-0.649-7.045-1.391-11.217-0.093c-5.284,1.483-8.621,4.45-10.661,7.231 c-1.483-2.039-3.708-3.337-5.562-4.357c-1.298-0.649-2.503-1.391-3.337-2.318c-2.039-2.039,0.371-6.304,0.371-6.304 c0.649-1.02,0.371-2.503-0.834-3.059c-1.391-1.02-2.781-0.649-3.43,0.464c-1.576,2.781-3.43,8.251,0.371,12.051 c1.298,1.298,2.874,2.225,4.357,2.966c3.059,1.761,4.821,2.874,4.821,5.84c-0.556,0.371-2.318,1.298-7.324,0.649 c-0.371,0-0.556,0-0.927,0.093c-4.264,1.298-9.085-0.464-12.515-4.264c-3.337-3.801-4.172-8.621-2.225-12.886 c0.185-0.556,0.185-1.112,0-1.761c-1.761-4.635-0.093-8.436,1.576-10.939c1.483-2.225,3.523-3.894,5.284-5.099 c0.556,0.371,1.112,0.464,1.854,0.371c5.84-1.483,9.734,5.284,10.012,5.655c0.464,0.834,1.112,1.112,1.947,1.112 c0.371,0,0.834-0.093,1.112-0.371c1.112-0.556,1.483-2.039,0.927-3.059c-0.185-0.371-3.43-6.118-9.178-7.787 c0.834-2.225,3.986-4.357,8.621-5.748c5.933-1.854,10.661-1.391,11.681-0.556c3.523,5.099,1.391,7.972-1.391,11.588 c-0.556,0.834-1.112,1.483-1.761,2.318c-4.635,6.86-1.298,12.051,1.298,13.905c0.464,0.371,0.927,0.464,1.391,0.464 c0.649,0,1.391-0.371,1.854-0.927c0.834-1.02,0.556-2.41-0.464-3.245c-0.556-0.464-3.337-2.967-0.093-7.694 c0.464-0.649,1.02-1.391,1.483-2.039c2.688-3.43,6.675-8.529,2.41-15.667c2.688-1.854,8.714-1.854,11.217-1.761h0.464 c0.371,0,0.834,0,1.298,0c3.059,0,7.787,0,10.568,1.483c0.464,0.185,1.02,0.371,1.576,0.185c6.582-1.298,13.998,1.298,16.779,3.894 c-1.298,2.503-3.43,8.158-2.225,13.442c1.391,6.211,1.576,7.787-3.43,9.641c-1.112,0.464-1.854,1.761-1.391,2.967 c0.371,0.927,1.298,1.483,2.225,1.483c0.185,0,0.556,0,0.834-0.093c3.337-1.298,5.284-2.874,6.304-4.728 c0.556,0.185,0.927,0.556,1.298,1.02c1.576,2.039,1.391,5.84,1.298,7.138c-0.185,1.298,0.649,2.41,1.947,2.688 c0.093,0,0.185,0,0.371,0c1.112,0,2.039-0.834,2.318-1.947c0.093-0.649,0.927-6.675-2.225-10.661 c-1.02-1.391-2.41-2.318-3.986-2.874c-0.093-1.854-0.464-3.801-0.927-5.748c-0.927-3.986,0.927-8.529,1.854-10.475 c2.039,0.093,3.894,0.927,5.284,2.225c1.391,1.391,1.947,3.245,1.854,5.099c-0.093,1.112,0.649,2.318,1.854,2.503 c1.112,0.185,2.41,1.483,3.337,3.43c2.688,5.377,2.966,14.74,0.834,20.209c0,0.093-0.093,0.093-0.093,0.093 c-2.039,2.966-4.728,3.059-9.178,3.059c-1.483,0-2.874,0-4.45,0.093c-7.045,0.649-10.383,7.694-10.475,8.065 c-0.556,1.112,0,2.503,1.112,3.059c0.371,0.093,0.649,0.185,0.927,0.185c0.927,0,1.761-0.464,2.039-1.391 c0,0,2.41-4.913,6.767-5.377c1.298-0.093,2.688-0.093,3.986-0.093c3.059,0,6.397,0,9.27-1.576 C177.092,97.685,174.496,104.36,169.861,106.956z M148.817,63.292c0.556,1.205,0.185,2.596-0.834,3.245 c-0.278,0.278-0.649,0.371-1.112,0.371c-0.834,0-1.483-0.371-1.947-1.02c-0.093-0.185-3.523-5.469-10.105-4.357 c-0.556,0.834-1.298,1.669-2.318,2.225c-0.464,0.278-0.927,0.649-1.391,0.834c-3.986,2.41-5.377,3.43-4.913,5.933 c0.185,1.298-0.556,2.503-1.854,2.688c-0.278,0-0.371,0-0.464,0c-1.205,0-2.132-0.834-2.318-1.947 c-1.02-5.84,3.337-8.343,7.138-10.661c0.464-0.278,0.927-0.649,1.391-0.834c2.596-1.669,1.576-6.767,1.576-6.767 c-0.185-1.298,0.464-2.596,1.761-2.781c1.298-0.185,2.596,0.464,2.781,1.761c0,0.278,0.371,2.318,0.185,4.728 C142.792,56.71,147.241,60.882,148.817,63.292z"></path>
        </svg>`,
        customUrl: "https://t3.chat/new?model=gemini-2.5-flash&q=%s&search=true"
    },
    "ai-with-reason": {
        icon: `<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 110.33" style="enable-background:new 0 0 122.88 110.33" xml:space="preserve"><g><path d="M13.9,67.74c1.15,0.54,2.34,0.96,3.59,1.28c1.24,0.32,2.54,0.55,3.87,0.67c1.18,0.11,2.4,0.15,3.65,0.12 c1.08-0.03,2.2-0.11,3.35-0.24c-0.26-1.96-0.39-3.7-0.34-5.26c0.05-1.73,0.33-3.22,0.89-4.53c0.52-1.21,1.26-2.23,2.27-3.08 c0.82-0.7,1.82-1.28,3.03-1.76c-0.79-0.75-1.51-1.43-2.14-2.07c-0.8-0.81-1.46-1.55-1.97-2.27c-1.28-1.79-1.7-3.34-1.08-4.99 c0.59-1.56,2.17-3.15,4.91-5.1c1.41-1,2-1.88,2.17-2.75c0.18-0.88-0.07-1.83-0.34-2.88c-0.15-0.6-0.31-1.22-0.43-1.83 c-0.12-0.59-0.21-1.2-0.25-1.86c-1.03-0.96-2.52-2.26-4.32-3.09c-1.85-0.85-4.05-1.22-6.43-0.21c-0.44,0.18-0.91,0.17-1.31,0.01 c-0.41-0.17-0.75-0.49-0.93-0.92l0,0c-0.18-0.44-0.17-0.9-0.01-1.31c0.17-0.41,0.49-0.75,0.92-0.93l0.01,0 c2.86-1.21,5.46-1.09,7.69-0.38c1.91,0.61,3.55,1.66,4.87,2.7c0.24-0.8,0.58-1.65,1.05-2.55c0.61-1.18,1.44-2.45,2.55-3.83 c0.49-0.6,0.97-1.23,1.43-1.9c0.46-0.67,0.89-1.41,1.28-2.23c0.39-0.83,0.74-1.77,1.02-2.86c0.28-1.1,0.5-2.34,0.63-3.78h0 c0.04-0.47,0.27-0.88,0.61-1.17c0.34-0.28,0.78-0.44,1.25-0.4c0.47,0.04,0.88,0.27,1.17,0.61l0.03,0.04 c0.26,0.33,0.41,0.76,0.37,1.22l-0.01,0.05c-0.15,1.64-0.4,3.07-0.73,4.34c-0.34,1.29-0.75,2.41-1.22,3.41 c-0.47,1.01-0.99,1.88-1.52,2.67c-0.53,0.78-1.08,1.48-1.62,2.16c-1.23,1.53-2.04,2.89-2.55,4.1c-0.49,1.17-0.7,2.21-0.75,3.15 c0.04,0.14,0.06,0.29,0.05,0.44c0,0.15-0.02,0.3-0.06,0.44c0.03,0.54,0.1,1.05,0.2,1.55c0.11,0.55,0.23,1.04,0.36,1.51 c0.42,1.62,0.79,3.08,0.48,4.59c-0.32,1.52-1.32,3.03-3.64,4.68c-1.83,1.3-2.89,2.28-3.33,3.14c-0.37,0.73-0.23,1.4,0.3,2.16 c0.79,1.12,2.24,2.49,4.11,4.25c0.77-1.74,1.69-3.21,2.74-4.41c1.2-1.37,2.57-2.39,4.11-3.08c1.7-0.76,3.57-1.1,5.6-1.03 c2.02,0.06,4.2,0.52,6.53,1.35c0.45,0.16,0.79,0.49,0.98,0.89c0.19,0.39,0.22,0.85,0.07,1.29l-0.02,0.05 c-0.16,0.44-0.49,0.77-0.88,0.95c-0.39,0.19-0.85,0.22-1.29,0.07l-0.04-0.01c-1.94-0.69-3.71-1.08-5.31-1.14 c-1.58-0.07-3,0.17-4.25,0.73c-1.24,0.55-2.34,1.44-3.31,2.66c-0.98,1.25-1.81,2.85-2.49,4.82l0,0c-0.06,0.17-0.15,0.33-0.25,0.48 c-0.09,0.12-0.2,0.23-0.32,0.32l-0.02,0.03c-0.01,0.02-0.04,0.05-0.08,0.09c-0.12,0.13-0.26,0.23-0.4,0.31 c-0.13,0.07-0.26,0.13-0.4,0.16c-0.02,0.01-0.05,0.02-0.08,0.02l-0.01,0c-1.66,0.37-2.93,0.86-3.89,1.49 c-0.93,0.61-1.55,1.35-1.94,2.25c-0.43,1-0.62,2.24-0.63,3.73c-0.01,1.53,0.18,3.32,0.49,5.41l0,0.02 c0.01,0.05,0.01,0.11,0.01,0.17c0.9,1.13,1.95,2.09,3.12,2.91c1.23,0.86,2.6,1.56,4.1,2.13c1.61,0.62,3.36,1.08,5.23,1.41 c1.87,0.33,3.86,0.54,5.95,0.65c0.1,0,0.19,0.02,0.28,0.04l0,0c0.09,0.02,0.18,0.04,0.26,0.08c1.09,0.34,2.4,0.43,3.89,0.31 c1.53-0.12,3.23-0.46,5.06-0.95c1.93-0.52,3.98-1.22,6.1-2.02c2.12-0.8,4.33-1.72,6.56-2.68l0.03-0.01 c0.05-0.02,0.11-0.04,0.16-0.06c0.07-0.02,0.13-0.04,0.19-0.05L85,69.12V62.1c0-0.03,0-0.07,0.01-0.1l0-0.05 c0.1-1.15,0.3-2.19,0.59-3.1c0.3-0.93,0.69-1.73,1.18-2.41c0.53-0.74,1.17-1.33,1.91-1.77c0.73-0.43,1.56-0.71,2.48-0.83 c0.06-0.01,0.1-0.02,0.14-0.02l0.01,0c0.05,0,0.09-0.01,0.13-0.01l1.29,0.02v0l0.05,0c2.79,0.04,5.36,0.07,7.3-2.12 c1-1.12,1.64-2.3,2.01-3.52c0.37-1.22,0.46-2.48,0.34-3.75c-0.12-1.34-0.47-2.69-0.95-4.04c-0.49-1.36-1.13-2.69-1.83-3.98 c-0.23-0.42-0.26-0.89-0.14-1.31c0.12-0.42,0.41-0.8,0.83-1.02l0.01,0c0.41-0.22,0.88-0.26,1.3-0.13c0.42,0.12,0.8,0.41,1.02,0.83 l0,0c0.79,1.44,1.51,2.97,2.07,4.53c0.57,1.58,0.97,3.2,1.12,4.83c0.15,1.7,0.03,3.4-0.47,5.06c-0.5,1.66-1.38,3.27-2.73,4.79 c-2.99,3.36-6.33,3.31-9.95,3.26v0l-0.05,0c-0.23,0-0.49-0.01-1.1-0.01c-0.43,0.06-0.81,0.19-1.14,0.39 c-0.33,0.2-0.62,0.46-0.87,0.8c-0.29,0.4-0.53,0.91-0.72,1.51c-0.19,0.62-0.32,1.33-0.4,2.15v6.12l10.93-2.82l0,0l0.02,0 c0.02-0.01,0.04-0.01,0.07-0.02l13-2.54c0.63-0.41,1.22-0.85,1.76-1.31c0.58-0.49,1.1-0.99,1.56-1.51 c1.43-1.59,2.39-3.37,2.97-5.27c0.62-2.05,0.79-4.25,0.59-6.49c-0.19-2.17-0.72-4.38-1.52-6.55c-0.85-2.32-1.99-4.59-3.34-6.73 c-0.94-1.49-1.99-2.92-3.1-4.25c-1.13-1.34-2.32-2.58-3.54-3.68c-0.1-0.09-0.19-0.19-0.26-0.29c-0.07-0.1-0.13-0.2-0.17-0.31 l-0.01-0.03c-1.07-2.65-2.27-5.18-3.74-7.47c-1.46-2.28-3.2-4.32-5.34-6.01c-2.14-1.69-4.7-3.04-7.84-3.94 c-3.16-0.91-6.9-1.37-11.36-1.26c-0.11,0-0.21,0-0.3-0.02c-0.09-0.01-0.18-0.04-0.27-0.06l-0.16-0.05 c-0.85,0.59-1.6,1.21-2.25,1.87c-0.7,0.7-1.28,1.42-1.76,2.18c-0.48,0.77-0.86,1.57-1.14,2.4c-0.28,0.84-0.46,1.71-0.54,2.61 c-0.04,0.43-0.23,0.8-0.52,1.08c-0.28,0.27-0.64,0.44-1.04,0.47c-0.03,0-0.06,0.01-0.09,0.01h-0.01c-1.55,0.09-2.91,0.42-4.09,0.96 c-1.25,0.57-2.31,1.37-3.19,2.37c-0.92,1.03-1.66,2.27-2.24,3.68c-0.61,1.46-1.05,3.1-1.33,4.86c0.19,0.46,0.34,0.94,0.46,1.43 c0.13,0.52,0.23,1.05,0.34,1.58c0.16,0.84,0.33,1.68,0.6,2.34c0.24,0.58,0.57,1.02,1.08,1.19c0.45,0.15,0.8,0.46,0.99,0.86 c0.2,0.39,0.25,0.86,0.1,1.31c-0.15,0.45-0.47,0.8-0.86,0.99c-0.39,0.2-0.86,0.25-1.31,0.1l-0.04-0.02 c-1.47-0.5-2.34-1.42-2.91-2.54c-0.55-1.09-0.79-2.33-1.03-3.58c-0.06-0.32-0.12-0.63-0.2-0.99l-0.01-0.04 c-0.05-0.24-0.11-0.48-0.18-0.7c-1.66-1.25-3.57-0.82-5.42,0.29v0c-1.99,1.19-3.94,3.14-5.5,4.7c-0.33,0.33-0.65,0.65-0.95,0.94 c-0.3,0.29-0.59,0.57-0.89,0.84c-0.35,0.32-0.8,0.46-1.24,0.44c-0.43-0.02-0.85-0.21-1.16-0.55l0,0c-0.02-0.02-0.04-0.04-0.05-0.06 c-0.29-0.35-0.42-0.78-0.4-1.2c0.02-0.43,0.21-0.85,0.55-1.16l0,0c0.02-0.02,0.04-0.03,0.06-0.05c0.44-0.4,1.02-0.98,1.65-1.61 c0-0.01,0.03-0.03,0.04-0.04c1.71-1.72,3.8-3.81,6.11-5.23c2.22-1.36,4.63-2.08,7.07-1.25c0.36-1.68,0.86-3.25,1.5-4.69 c0.69-1.54,1.56-2.93,2.62-4.12c1.09-1.22,2.37-2.23,3.85-2.98c1.31-0.66,2.79-1.13,4.44-1.35c0.16-0.84,0.38-1.66,0.68-2.46 c0.34-0.92,0.78-1.8,1.32-2.65c0.45-0.72,0.98-1.41,1.57-2.07c0.39-0.44,0.81-0.86,1.26-1.27c-1.68-0.44-3.35-0.85-5.01-1.22 c-1.91-0.42-3.8-0.78-5.67-1.07l-0.07,0.03c-0.62,0.23-1.2,0.68-1.73,1.29c-0.62,0.71-1.18,1.64-1.67,2.66 c-0.65,1.36-1.16,2.87-1.54,4.31c-0.49,1.84-0.77,3.59-0.87,4.82c-0.04,0.47-0.27,0.89-0.6,1.17c-0.33,0.28-0.77,0.44-1.23,0.4 l-0.04,0c-0.46-0.04-0.87-0.27-1.15-0.6c-0.28-0.33-0.44-0.77-0.4-1.23l0-0.04c0.12-1.38,0.44-3.35,0.99-5.42 c0.43-1.64,1.01-3.35,1.75-4.9c0.36-0.75,0.75-1.47,1.2-2.13c0.22-0.33,0.44-0.64,0.68-0.93c-0.85-0.07-1.69-0.12-2.54-0.16 c-1.17-0.05-2.34-0.05-3.5-0.02c-4.09,0.12-8.15,0.76-12.21,2.09c-3.89,1.28-7.77,3.19-11.69,5.91c0.45,0.29,0.87,0.61,1.28,0.94 c0.61,0.51,1.17,1.06,1.68,1.65c0.71,0.83,1.3,1.75,1.76,2.72c0.45,0.95,0.76,1.95,0.92,2.98c0.07,0.47-0.06,0.92-0.32,1.28 c-0.26,0.35-0.66,0.61-1.13,0.68c-0.47,0.07-0.92-0.06-1.28-0.32c-0.35-0.26-0.61-0.66-0.68-1.13c-0.11-0.71-0.33-1.4-0.64-2.06 c-0.32-0.68-0.75-1.33-1.26-1.93c-0.52-0.61-1.13-1.17-1.82-1.66c-0.66-0.47-1.38-0.88-2.15-1.19c-0.78,0.42-1.55,0.85-2.29,1.3 c-0.82,0.49-1.62,1.01-2.39,1.54c-1.08,0.75-2.11,1.56-3.09,2.44c-0.85,0.76-1.65,1.57-2.39,2.44c1.92,1.57,2.68,3.24,2.82,4.99 c0.15,1.82-0.38,3.69-0.94,5.65c0,0.02-0.01,0.04-0.02,0.07c-1.01,3.57-2.13,7.57,2.81,11.79c0.36,0.31,0.56,0.74,0.6,1.17 c0.03,0.44-0.1,0.89-0.41,1.25c-0.31,0.36-0.74,0.56-1.17,0.6c-0.44,0.03-0.89-0.1-1.25-0.41c-3.31-2.82-4.6-5.54-4.9-8.13 c-0.3-2.57,0.38-4.97,1.02-7.23c0.42-1.48,0.82-2.89,0.75-4.14c-0.06-1.08-0.49-2.1-1.6-3.02c-1.48,1.67-2.85,3.4-4.07,5.23 c-1.3,1.95-2.41,4.02-3.29,6.24c-0.98,2.49-1.66,5.19-1.95,8.14c-0.29,2.96-0.19,6.19,0.38,9.75c0.3,1.88,0.64,3.55,1.08,5.04 c0.44,1.46,0.98,2.76,1.7,3.91c0.7,1.12,1.59,2.13,2.75,3.07C10.68,66.04,12.12,66.91,13.9,67.74L13.9,67.74z M86.82,42.45 c2.21,2.05,2.91,3.61,2.65,5.16c-0.26,1.56-1.5,2.97-3.15,4.87l0,0c-0.78,0.89-1.67,1.92-2.52,3.07c-0.28,0.38-0.69,0.61-1.13,0.68 c-0.43,0.06-0.89-0.04-1.27-0.32c-0.38-0.28-0.61-0.69-0.68-1.13c-0.06-0.43,0.04-0.89,0.32-1.27c1-1.34,1.9-2.38,2.68-3.28 l0.01-0.01c1-1.15,1.75-2.01,1.93-2.8c0.15-0.67-0.12-1.37-1.05-2.32l-0.37,0.14v0c-0.2,0.07-0.49,0.18-0.83,0.3 c-0.32,0.11-0.67,0.24-1.03,0.37c-0.38,0.14-0.8,0.31-1.23,0.49c-0.17,0.07-0.32,0.14-0.47,0.21l-0.48,0.22 c-0.36,0.17-0.73,0.34-1.1,0.5c-0.39,0.16-0.78,0.31-1.18,0.43c-0.53,0.16-1.09,0.34-1.56,0.49l-0.03,0.01 c-1.28,0.4-1.96,0.62-2.9,0.66c-0.5,0.02-1-0.02-1.63-0.13c-0.62-0.1-1.34-0.26-2.33-0.47l-0.95-0.2 c-0.03-0.01-0.05-0.01-0.08-0.02l-0.1-0.03l-3.98-1.33c-0.03-0.01-0.05-0.01-0.07-0.02c-0.44-0.15-0.77-0.46-0.97-0.85 c-0.19-0.38-0.24-0.84-0.11-1.28l0.02-0.06c0.15-0.44,0.46-0.77,0.85-0.97c0.39-0.19,0.84-0.24,1.28-0.11 c0.03,0.01,0.05,0.02,0.07,0.03l3.85,1.28l0.9,0.19c0.88,0.19,1.53,0.33,2.04,0.41c0.48,0.08,0.81,0.12,1.08,0.11 c0.43-0.02,0.97-0.19,1.98-0.51c0.25-0.07,0.49-0.16,0.74-0.23c0.3-0.09,0.61-0.19,0.91-0.28c0.61-0.18,1.21-0.46,1.81-0.74 l0.52-0.24c0.18-0.08,0.36-0.16,0.55-0.24c1.06-0.45,1.83-0.72,2.45-0.94c0.62-0.22,0.94-0.33,1.02-0.55 c0.13-0.32,0.08-1-0.03-2.36c-0.12-1.56-0.17-2.8-0.09-3.87c0.08-1.1,0.31-2.01,0.76-2.87c0.44-0.85,1.05-1.58,1.91-2.31 c0.83-0.71,1.89-1.43,3.24-2.29L89.15,28c0.42-0.27,0.74-0.46,1.01-0.63l0.05-0.03c0.77-0.47,1.21-0.74,1.42-1.12 c0.23-0.4,0.29-1.04,0.31-2.26c0.01-0.71,0.04-1.36,0.13-1.98c0.09-0.65,0.24-1.25,0.5-1.82c0.3-0.64,0.71-1.2,1.28-1.68 c0.56-0.47,1.28-0.85,2.19-1.14c0.45-0.14,0.92-0.09,1.31,0.11c0.39,0.2,0.7,0.56,0.85,1.01c0.14,0.45,0.09,0.92-0.11,1.31 c-0.2,0.39-0.56,0.7-1.01,0.85c-0.42,0.13-0.73,0.29-0.96,0.46c-0.2,0.15-0.34,0.33-0.43,0.52c-0.12,0.26-0.2,0.6-0.24,0.99 c-0.05,0.43-0.07,0.91-0.08,1.43c-0.04,2.07-0.16,3.17-0.66,4.02c-0.51,0.87-1.31,1.36-2.74,2.24l-0.51,0.31l-0.45,0.28l-0.1,0.07 c-1.14,0.73-2.02,1.31-2.67,1.84c-0.62,0.5-1.03,0.95-1.27,1.42c-0.24,0.47-0.36,1.04-0.4,1.8c-0.04,0.8,0.01,1.82,0.11,3.11 c0.06,0.82,0.11,1.49,0.14,2.1C86.84,41.71,86.84,42.11,86.82,42.45L86.82,42.45z M67.07,67.85c0.36,0.28,0.58,0.67,0.65,1.09 c0.07,0.43-0.02,0.89-0.3,1.28l-0.01,0.01c-0.28,0.38-0.68,0.61-1.11,0.68c-0.43,0.07-0.89-0.02-1.28-0.3l0,0 c-0.25-0.18-0.48-0.37-0.69-0.58c-0.22-0.21-0.42-0.44-0.6-0.68c-0.54-0.71-0.93-1.53-1.16-2.41c-0.24-0.91-0.32-1.89-0.25-2.86 c0.06-0.92,0.26-1.86,0.58-2.75c0.31-0.87,0.74-1.71,1.28-2.46l0,0c0.25-0.34,0.52-0.67,0.81-0.98c0.29-0.3,0.59-0.57,0.92-0.82 L65.99,57c0.48-0.36,0.99-0.68,1.53-0.96c0.54-0.28,1.11-0.52,1.7-0.72c0.6-0.2,1.22-0.37,1.87-0.5c0.64-0.13,1.31-0.22,2-0.28 l0.14-0.01h6c0.48,0,0.91,0.19,1.22,0.5l0.03,0.03c0.29,0.31,0.47,0.73,0.47,1.18c0,0.48-0.19,0.91-0.5,1.22 c-0.31,0.31-0.74,0.5-1.22,0.5h-5.95c-0.53,0.05-1.04,0.12-1.54,0.22c-0.5,0.1-0.98,0.22-1.42,0.37c-0.42,0.14-0.83,0.31-1.21,0.51 c-0.37,0.19-0.72,0.4-1.04,0.64L68,59.79c-0.19,0.15-0.37,0.31-0.54,0.48c-0.18,0.18-0.34,0.38-0.49,0.59 c-0.35,0.48-0.63,1.03-0.84,1.61c-0.21,0.59-0.34,1.21-0.38,1.82l0,0.01c-0.04,0.59,0,1.16,0.13,1.67 c0.12,0.48,0.31,0.91,0.59,1.27l0.02,0.03c0.08,0.1,0.16,0.19,0.25,0.28l0,0c0.09,0.09,0.19,0.17,0.3,0.25L67.07,67.85L67.07,67.85 z M40.58,65.49c-0.45,0.11-0.9,0.03-1.28-0.2l0,0c-0.38-0.23-0.67-0.6-0.79-1.06c-0.12-0.46-0.03-0.92,0.19-1.3l0,0 c0.23-0.38,0.6-0.67,1.06-0.79c3.91-0.99,6.27-1.06,8.13-0.4c1.88,0.67,3.15,2.04,4.93,3.94l0.2,0.22c0.73,0.78,1.33,1.41,1.87,1.9 c0.51,0.47,0.97,0.82,1.42,1.05c0.43,0.22,0.9,0.36,1.49,0.44c0.62,0.09,1.36,0.11,2.28,0.1h0c0.47-0.01,0.9,0.18,1.22,0.48 c0.31,0.3,0.51,0.73,0.52,1.21v0.01h0l0,0.05c-0.01,0.45-0.19,0.87-0.48,1.17c-0.3,0.31-0.73,0.51-1.2,0.52h-0.01v0l-0.04,0 c-1.18,0.02-2.14-0.02-2.98-0.16c-0.88-0.14-1.64-0.38-2.37-0.76c-0.71-0.36-1.35-0.83-2.03-1.44c-0.66-0.59-1.36-1.32-2.2-2.22 l-0.2-0.22c-1.33-1.43-2.29-2.46-3.6-2.92c-1.33-0.46-3.1-0.39-6.09,0.37L40.58,65.49L40.58,65.49z M77.6,23.75 c-0.11-0.31-0.24-0.6-0.39-0.88c-0.2-0.36-0.44-0.69-0.69-0.97c-0.28-0.32-0.58-0.59-0.87-0.81c-0.31-0.23-0.61-0.4-0.88-0.51l0,0 c-0.44-0.17-0.77-0.51-0.95-0.91c-0.18-0.4-0.2-0.87-0.03-1.31l0,0c0.17-0.44,0.51-0.77,0.91-0.95c0.4-0.18,0.87-0.2,1.31-0.03 c0.52,0.2,1.08,0.51,1.63,0.91c0.5,0.37,1,0.82,1.46,1.35c0.28,0.32,0.55,0.67,0.79,1.04c0.14,0.21,0.27,0.43,0.39,0.65 c0.23-0.11,0.47-0.22,0.74-0.34l0.03-0.01c0.43-0.19,0.91-0.39,1.45-0.61c0.54-0.22,1.14-0.47,1.83-0.77 c0.68-0.3,1.44-0.64,2.3-1.06c0.43-0.21,0.9-0.22,1.31-0.07c0.42,0.14,0.78,0.45,0.98,0.88c0.21,0.43,0.22,0.9,0.07,1.31 c-0.14,0.42-0.45,0.78-0.88,0.98c-0.87,0.42-1.67,0.79-2.39,1.1c-0.69,0.3-1.32,0.56-1.89,0.8c-0.02,0.01-0.05,0.02-0.08,0.03 c-2.72,1.13-3.31,1.39-3.6,4.54l-0.01,0.11c-0.18,1.89-0.31,3.36-0.83,4.76c-0.52,1.42-1.41,2.71-3.08,4.2 c-0.35,0.32-0.8,0.46-1.24,0.43c-0.44-0.03-0.87-0.22-1.19-0.57c-0.32-0.35-0.46-0.8-0.43-1.24c0.03-0.44,0.22-0.87,0.57-1.19 c1.18-1.05,1.8-1.97,2.16-2.98c0.37-1.04,0.48-2.21,0.62-3.71l0.01-0.11c0.09-0.99,0.2-1.8,0.35-2.47 C77.22,24.71,77.39,24.19,77.6,23.75L77.6,23.75z M4.86,45.88c0-0.02,0-0.05,0-0.07c0.03-0.45,0.23-0.86,0.54-1.15 c0.32-0.3,0.75-0.48,1.21-0.46v0c0.02,0,0.05,0,0.07,0c0.45,0.03,0.86,0.23,1.15,0.54c0.3,0.32,0.48,0.76,0.46,1.23 c-0.06,1.82,0.52,2.94,1.45,3.73c0.98,0.83,2.38,1.34,3.86,1.88c2.21,0.81,4.55,1.66,6.46,3.42c1.92,1.77,3.37,4.41,3.71,8.74 c0.04,0.47-0.12,0.92-0.41,1.25c-0.29,0.34-0.7,0.56-1.17,0.6c-0.47,0.04-0.92-0.12-1.25-0.41c-0.34-0.29-0.56-0.7-0.6-1.17 c-0.26-3.26-1.35-5.23-2.8-6.54l-0.03-0.03c-1.46-1.31-3.33-1.99-5.09-2.63c-2.01-0.73-3.91-1.43-5.32-2.71 C5.66,50.79,4.77,48.92,4.86,45.88L4.86,45.88L4.86,45.88z M85.28,72.59c0.68,0.3,1.37,0.54,2.09,0.73 c1.15,0.3,2.34,0.48,3.57,0.53c1.69,0.07,3.46-0.08,5.3-0.42c1.85-0.34,3.77-0.87,5.75-1.56c0.45-0.16,0.92-0.12,1.31,0.08 c0.4,0.19,0.72,0.53,0.87,0.98c0.16,0.45,0.12,0.92-0.08,1.31c-0.19,0.4-0.53,0.72-0.98,0.87c-2.16,0.76-4.28,1.34-6.33,1.71 c-2.06,0.37-4.06,0.54-5.99,0.46c-1.91-0.08-3.75-0.4-5.49-0.99c-1.68-0.57-3.28-1.38-4.77-2.47l-5.46,1.41 c1.13,1.38,2.32,2.56,3.59,3.54c1.44,1.11,2.98,1.94,4.63,2.49c1.8,0.59,3.75,0.84,5.85,0.71c2.12-0.13,4.4-0.65,6.85-1.57 c0.44-0.17,0.91-0.14,1.31,0.04c0.4,0.18,0.73,0.52,0.9,0.96c0.17,0.44,0.14,0.91-0.04,1.31c-0.18,0.4-0.52,0.73-0.96,0.9 c-2.82,1.07-5.47,1.66-7.96,1.8c-2.5,0.14-4.84-0.16-7.02-0.88c-2.09-0.69-4.03-1.76-5.83-3.17c-1.69-1.33-3.26-2.97-4.71-4.89 c-0.49,0.2-0.99,0.41-1.51,0.62c-0.41,0.17-0.83,0.34-1.26,0.51c1.12,1.61,2.29,3.04,3.5,4.29c1.34,1.39,2.72,2.55,4.14,3.48 c1.29,0.84,2.59,1.49,3.91,1.92c1.28,0.42,2.56,0.65,3.84,0.67l0.11-0.02l0.04,0c0.05-0.01,0.09-0.01,0.13-0.01 c4.35-0.23,7.99-0.77,10.98-1.69c2.96-0.91,5.3-2.19,7.08-3.92c1.67-1.63,2.88-3.68,3.7-6.24c0.78-2.44,1.19-5.33,1.3-8.73 l-7.54,1.47L85.28,72.59L85.28,72.59z M86.57,91.21l1.75,15.59c0.05,0.46-0.1,0.91-0.37,1.25c-0.27,0.34-0.68,0.58-1.15,0.63 l-0.02,0c-0.46,0.05-0.91-0.1-1.25-0.37c-0.34-0.27-0.58-0.68-0.63-1.15l-1.78-15.84c-1.37-0.12-2.73-0.42-4.07-0.89 c-1.49-0.52-2.96-1.26-4.39-2.2c-1.67-1.1-3.31-2.47-4.87-4.11c-1.47-1.54-2.87-3.31-4.19-5.29c-0.77,0.28-1.54,0.54-2.29,0.78 c-0.89,0.29-1.75,0.54-2.58,0.77l-0.24,0.06c1.57,2.8,3.3,4.92,5.06,6.65c1.88,1.85,3.8,3.25,5.58,4.54 c2.64,1.93,5.01,3.66,6.7,6.18c1.7,2.54,2.68,5.83,2.51,10.85c-0.02,0.47-0.22,0.9-0.54,1.2c-0.32,0.3-0.76,0.48-1.23,0.46 c-0.47-0.01-0.9-0.22-1.2-0.54c-0.3-0.32-0.48-0.76-0.46-1.23c0.14-4.14-0.67-6.85-2.07-8.92c-1.41-2.09-3.45-3.58-5.73-5.23 c-1.97-1.44-4.1-2.99-6.2-5.09c-2.06-2.06-4.09-4.63-5.92-8.12c-1.26,0.2-2.47,0.31-3.6,0.29c-1.24-0.01-2.38-0.17-3.43-0.48 c-2.2-0.12-4.31-0.34-6.31-0.71c-2.03-0.37-3.94-0.88-5.71-1.55c-1.72-0.66-3.32-1.47-4.76-2.48c-1.37-0.95-2.61-2.06-3.69-3.36 c-1.42,0.18-2.81,0.3-4.18,0.34c-1.46,0.04-2.89,0-4.28-0.13c-1.52-0.14-3-0.4-4.43-0.77c-1.43-0.37-2.82-0.87-4.16-1.49 c-2.1-0.98-3.8-2.02-5.2-3.16c-1.41-1.16-2.52-2.42-3.41-3.84c-0.87-1.39-1.52-2.91-2.03-4.61c-0.5-1.67-0.88-3.53-1.22-5.61 c-0.63-3.88-0.73-7.42-0.41-10.67c0.32-3.27,1.08-6.25,2.17-9.01c1.08-2.75,2.48-5.27,4.12-7.62c1.63-2.35,3.48-4.53,5.46-6.62 c0.98-1.23,2.05-2.35,3.18-3.39c1.13-1.03,2.34-1.98,3.6-2.87c1.24-0.86,2.53-1.66,3.86-2.41c1.32-0.75,2.67-1.44,4.03-2.09 c4.37-3.09,8.72-5.25,13.07-6.67c4.36-1.43,8.73-2.11,13.13-2.24c4.34-0.13,8.7,0.29,13.12,1.07c4.39,0.77,8.84,1.9,13.39,3.21 c4.81-0.09,8.87,0.43,12.33,1.46c3.5,1.03,6.39,2.57,8.82,4.49c2.41,1.9,4.34,4.15,5.97,6.64c1.6,2.45,2.89,5.11,4.03,7.89 c1.28,1.17,2.51,2.47,3.68,3.87c1.18,1.42,2.28,2.93,3.28,4.51c1.49,2.36,2.75,4.88,3.69,7.45c0.89,2.44,1.48,4.92,1.69,7.37 c0.24,2.69,0.02,5.34-0.75,7.85c-0.72,2.33-1.92,4.52-3.69,6.5c-0.6,0.66-1.25,1.3-1.96,1.89c-0.69,0.58-1.44,1.13-2.26,1.65 c-0.1,0.07-0.21,0.14-0.33,0.19c-0.11,0.05-0.23,0.09-0.36,0.11l-2.35,0.46c-0.07,4.06-0.55,7.53-1.49,10.48 c-0.99,3.08-2.48,5.6-4.57,7.63c-2.02,1.97-4.57,3.44-7.71,4.5C94.3,90.26,90.74,90.89,86.57,91.21L86.57,91.21z"/></g></svg>`,
        customUrl: "https://t3.chat/new?model=gemini-2.5-pro&q=%s"
    }
};

// --- Engine Selector Behavior ---
// When the container is clicked, toggle the "expanded" state and update placeholder
engineSelectorContainer.addEventListener("click", (e) => {
    e.stopPropagation();
    engineSelectorContainer.classList.toggle("expanded");
    if (engineSelectorContainer.classList.contains("expanded")) {
        searchInput.setAttribute("placeholder", "Choose Engine");
    } else {
        searchInput.setAttribute("placeholder", "Search anything...");
    }
});

// When an option is clicked, update the main icon, collapse the container,
// and update the placeholder back to "Search anything..."
engineOptionButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
        e.stopPropagation();
        currentEngine = button.dataset.engine;
        updateEngineIcon();
        engineSelectorContainer.classList.remove("expanded");
        searchInput.setAttribute("placeholder", "Search anything...");
    });
});

function updateEngineIcon() {
    if (engines[currentEngine]) {
        currentEngineIcon.innerHTML = engines[currentEngine].icon;
    }
}

// --- Suggestions & Search Functionality ---
function fetchSuggestions(query) {
    if (!query || query.trim() === "") {
        suggestionsContainer.innerHTML = "";
        suggestionsData = [];
        return Promise.resolve([]);
    }
    if (clientCache[query]) {
        suggestionsData = clientCache[query];
        renderSuggestions();
        return Promise.resolve(suggestionsData);
    }
    if (controller) {
        controller.abort();
    }
    controller = new AbortController();
    suggestionsContainer.innerHTML = "";
    return fetch(`/api/suggestions?q=${encodeURIComponent(query)}`, {
        signal: controller.signal,
        headers: { "X-Requested-With": "XMLHttpRequest" }
    })
        .then((response) => response.json())
        .then((data) => {
            if (searchInput.value.trim() !== query) return [];
            if (!searchInput.value.trim()) {
                suggestionsContainer.innerHTML = "";
                suggestionsData = [];
                return [];
            }
            suggestionsData = Array.isArray(data) ? data : [];
            clientCache[query] = suggestionsData;
            activeIndex = -1;
            renderSuggestions();
            return suggestionsData;
        })
        .catch((error) => {
            if (error.name !== "AbortError") {
                console.error("Error fetching suggestions:", error);
                suggestionsData = [];
                suggestionsContainer.innerHTML = "";
            }
            return [];
        });
}

function renderSuggestions() {
    suggestionsContainer.innerHTML = "";
    if (!searchInput.value.trim()) {
        suggestionsData = [];
        return;
    }
    if (!suggestionsData.length) return;
    const fragment = document.createDocumentFragment();
    suggestionsData.forEach((suggestion) => {
        const element = document.createElement("div");
        element.className =
            "suggestion p-2 cursor-pointer hover:bg-blue-900/70 transition-colors";
        element.textContent = suggestion;
        element.onclick = () => {
            searchInput.value = suggestion;
            performSearch(suggestion);
        };
        fragment.appendChild(element);
    });
    suggestionsContainer.appendChild(fragment);
}

function handleInput() {
    const query = searchInput.value.trim();
    if (!query) {
        suggestionsContainer.innerHTML = "";
        suggestionsData = [];
        return;
    }
    window.requestAnimationFrame(() => {
        fetchSuggestions(query);
    });
}

function updateActiveSuggestion() {
    const suggestionElements = suggestionsContainer.querySelectorAll(
        ".suggestion"
    );
    suggestionElements.forEach((element, index) => {
        if (index === activeIndex) {
            element.classList.add("active");
        } else {
            element.classList.remove("active");
        }
    });
}

function performSearch(query) {
    if (!query) return;
    
    // Check if the current engine has a customUrl
    if (engines[currentEngine] && engines[currentEngine].customUrl) {
        // Replace %s with the encoded search query
        const url = engines[currentEngine].customUrl.replace('%s', encodeURIComponent(query));
        window.location.href = url;
        return;
    }
    
    if (currentEngine !== "web" && !query.startsWith("!")) {
        query = engines[currentEngine].bang + query;
    }
    const isURLLike = query.includes(".") && !query.startsWith("!");
    // A more robust URL test pattern:
    const domainPattern =
        /^(www\.)?[a-zA-Z0-9][-a-zA-Z0-9@:%._+~#=]{0,256}\.[a-zA-Z0-9()]{1,}(\.[a-zA-Z0-9()]{1,})*$/i;
    if (isURLLike && domainPattern.test(query)) {
        const url =
            query.startsWith("http://") || query.startsWith("https://")
                ? query
                : "https://" + query;
        window.location.href = url;
    } else {
        window.location.href = `https://unduck.link?q=${encodeURIComponent(query)}`;
    }
}

// --- Event Listeners ---
searchInput.addEventListener("input", handleInput);
searchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
        e.preventDefault();
        if (activeIndex >= 0 && activeIndex < suggestionsData.length) {
            searchInput.value = suggestionsData[activeIndex];
        }
        performSearch(searchInput.value.trim());
        return;
    }
    const suggestionElements = suggestionsContainer.querySelectorAll(
        ".suggestion"
    );
    if (!suggestionElements.length) return;
    if (e.key === "ArrowDown") {
        e.preventDefault();
        activeIndex = (activeIndex + 1) % suggestionElements.length;
        updateActiveSuggestion();
    } else if (e.key === "ArrowUp") {
        e.preventDefault();
        activeIndex =
            activeIndex <= 0 ? suggestionElements.length - 1 : activeIndex - 1;
        updateActiveSuggestion();
    } else if (e.key === "Escape") {
        e.preventDefault();
        suggestionsContainer.innerHTML = "";
        suggestionsData = [];
    }
});

searchBtn.addEventListener("click", () => {
    performSearch(searchInput.value.trim());
});

document.addEventListener("click", (e) => {
    if (
        !searchInput.contains(e.target) &&
        !suggestionsContainer.contains(e.target)
    ) {
        suggestionsContainer.innerHTML = "";
        suggestionsData = [];
    }
});

window.addEventListener("load", () => {
    searchInput.setAttribute("autocomplete", "off");
    searchInput.focus();
    updateEngineIcon();
    // Prefetch common suggestions
    setTimeout(() => {
        ["a", "how", "what", "why","cricbuzz"].forEach((term) => {
            fetch(`/api/suggestions?q=${term}`)
                .then((response) => response.json())
                .then((data) => {
                    if (Array.isArray(data)) {
                        clientCache[term] = data;
                    }
                })
                .catch(() => {});
        });
    }, 1000);
});

// Event listeners for selecting the engine
document.addEventListener('click', function(event) {
  const engineOption = event.target.closest('.engine-option');
  if (engineOption) {
    const engineKey = engineOption.dataset.engine;
    if (engineKey) {
      setSelectedEngine(engineKey);
      closeEngineOptions();
    }
  }
  
  // Close engine options when clicking outside
  if (!event.target.closest('.engine-options') && !event.target.closest('.engine-select-button')) {
    closeEngineOptions();
  }
});
